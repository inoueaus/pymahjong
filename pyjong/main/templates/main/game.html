{% extends "base.html" %}

{% block content %}



<!-- Game script -->







<!-- Chat room　script  -->
          <script type="text/javascript" charset="utf-8">
              var socket;
              $(document).ready(function(){
                  socket = io.connect('http://' + document.domain + ':' + location.port + '/main/game');
                  socket.on('connect', function() {
                      socket.emit('joined', {});
                      console.log('connected');
                  });
                  socket.on('status', function(data) {
                      $('#chat').val($('#chat').val() + '・' + data.msg + '\n');
                      $('#chat').scrollTop($('#chat')[0].scrollHeight);
                      console.log('status func')
                  });
                  socket.on('message', function(data) {
                      $('#chat').val($('#chat').val() + data.msg + '\n');
                      $('#chat').scrollTop($('#chat')[0].scrollHeight);
                      console.log('message func')
                  });
                  socket.on('gameupdate', function(data) {
                      $('#game').val($('#game').val() + data.msg + '\n');
                      $('#game').scrollTop($('#game')[0].scrollHeight);
                      console.log('game message func')
                  });
                  $('#text').keypress(function(e) {
                      var code = e.keyCode || e.which;
                      console.log('keypress')
                      if (code == 13) {
                          text = $('#text').val();
                          $('#text').val('');
                          socket.emit('text', {msg: text});
                          console.log('emit text',text)

                      }
                  });
                  $('#gamecontrol').keypress(function(e) {
                      var code = e.keyCode || e.which;
                      console.log('keypress')
                      if (code == 13) {
                          text = $('#gamecontrol').val();
                          $('#gamecontrol').val('');
                          socket.emit('gamecontrol', {msg: text});
                          console.log('emit text',text)

                      }
                  });
                  $('#startsolo').on('click', function() {
                    socket.emit('startsolo');
                    console.log('startsolo')
                  });
                  $('#gamestart').on('click', function() {
                    socket.emit('start');
                    console.log('gamestart')
                  });
                  $('#gamestart2').on('click', function() {
                    socket.emit('gamecheck');
                    console.log('gamecheck')
                  });

              });
              function leave_room() {
                  socket.emit('left', {}, function() {
                      socket.disconnect();

                      // go back to the friends page
                      window.location.href = "{{ url_for('main.friends') }}";
                  });
              }
          </script>








{% if session['in_room'] == True %}


</head>
<div class="container py-3">
<h1>PyJongルーム</h1>
<h5 class="pt-1">ルーム名： {{ session['room'] }}</h5>
</div>

<!-- MahJong -->
<div class="container">
<h3><strong>Game</strong></h3>
<div class="float-end">
  <button type="button" id="gamestart" class="btn btn-outline-primary">ゲームをスタート</button>
</div>
</div>

<div class="container pt-2">
  <textarea class="form-control" style="height: 300px" id="game" rows="20"></textarea>
</div>

<div class="form-floating px-5">

  <div class="pt-2 pb-5 px-5">
    <input class="form-control" id="gamecontrol" placeholder="エンターキーを押して送信">
  </div>
  <div class="float-end">
    <button type="button" id="gamestart2" class="btn btn-outline-primary">ゲームをスタート</button>
  </div>
</div>




{% if session['players'] != 1 %}
<!-- Chat box -->
        <div class="form-floating px-5">
          <div class="pt-2">
            <textarea class="form-control" style="height: 300px" id="chat" rows="20"></textarea>
          </div>
          <div class="pt-2 pb-5">
            <input class="form-control" id="text" placeholder="エンターキーを押して送信">
          </div>
          <div class="float-end">
            <button type="button" onclick="leave_room();" class="btn btn-outline-warning">チャットルームを大会する</button>
          </div>
        </div>
{% else %}

{% endif %}


<!-- Room creation -->
{% else %}

{% if session['has_friends'] %}

<div class="container">
  <h1 class="">友達を誘ってチャットを始めましょう！</h1>
  <form class="" action="" method="POST">
    <div class="form-floating px-5">

  {{form.hidden_tag()}}
  <div class="py-2">
  {{form.select_friend.label(class="form-label")}}
  {{form.select_friend(class="form-select")}}
</div>
<div class="py-2">
  {{form.room_name.label(class="form-label")}}
  {{form.room_name(class="form-control")}}

</div>
  {{form.submit(class="btn btn-outline-primary")}}

</div>
  </form>
  <div class="container px-5">
  <p class="text-muted pt-3">もしくは</p>
  <div class="py-2">
    <form class="" action="" method="POST">
      {{solo_form.hidden_tag()}}
      {{solo_form.submit(class="btn btn-outline-secondary")}}
    </form>
  </div>
  </div>
</div>

{% else %}

{% endif %}
{% endif %}




{% endblock %}
